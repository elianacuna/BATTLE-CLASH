<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Actualizar Usuario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <header class="text-center py-3">
        <h1>Actualizar Usuario</h1>
    </header>

    <div class="container mt-4">
        <form id="updateForm">
            <input type="hidden" id="userId">
            <div class="mb-3">
                <label for="username" class="form-label">ID Usuario</label>
                <input type="text" class="form-control" id="username" disabled>
            </div>
            <div class="mb-3">
                <label for="editRol" class="form-label">Rol</label>
                <select id="editRol" class="form-control">
                    <option value="Admin">Admin</option>
                    <option value="Jugador">Jugador</option>
                    <option value="Bloqueado">Bloqueado</option>
                    <option value="SQA">SQA</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Guardar cambios</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Función para obtener el parámetro 'id' de la URL
        function getParameterByName(name) {
            const url = window.location.href;
            const nameRegex = name.replace(/[\[\]]/g, '\\$&');
            const regex = new RegExp('[?&]' + nameRegex + '(=([^&#]*)|&|#|$)');
            const results = regex.exec(url);
            return results ? decodeURIComponent(results[2].replace(/\+/g, ' ')) : null;
        }

        const userId = getParameterByName('id'); // Obtiene el ID del usuario de la URL

        // Función para cargar los datos del usuario
        function cargarDatosUsuario(id) {
            $.ajax({
                url: '../../modules/apis/usuario.php?action=getUser', // Cambia la URL según tu API para obtener un usuario
                method: 'GET',
                data: {
                    id: id
                },
                success: function(response) {
                    if (response.status === 'success') {
                        // Rellenar los campos con los datos del usuario
                        $('#userId').val(response.data.ID);
                        $('#username').val(response.data.Username);
                        $('#editRol').val(response.data.rol); // Asigna el rol actual al select
                    } else {
                        alert('Error al cargar los datos del usuario: ' + response.message);
                    }
                },
                error: function(error) {
                    console.error('Error al obtener los datos del usuario:', error);
                    alert('Ocurrió un error al intentar cargar los datos del usuario.');
                }
            });
        }

        $(document).ready(function() {
            if (userId) {
                cargarDatosUsuario(userId);
            } else {
                alert('No se encontró el ID del usuario en la URL');
            }
        });

        $('#updateForm').on('submit', function(e) {
            e.preventDefault();

            const rol = $('#editRol').val(); 
            const id = $('#userId').val();

            $.ajax({
                url: '../../modules/apis/usuario.php?action=update', 
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    id: id,
                    rol: rol
                }),
                success: function(response) {
                    if (response.status === 'success') {
                        alert('Usuario actualizado correctamente');
                        window.location.href = 'usurios.html'; 
                    } else {
                        alert('Error al actualizar el usuario: ' + response.message);
                    }
                },
                error: function(error) {
                    console.error('Error al actualizar el usuario:', error);
                    alert('Ocurrió un error al intentar actualizar el usuario.');
                }
            });
        });
    </script>
</body>
</html>
